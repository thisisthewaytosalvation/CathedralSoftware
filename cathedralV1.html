<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gatekeeper - Internal Systems v1.0</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap');
        
        :root {
            --base-grey: #c0c0c0;
            --shadow-dark: #808080;
            --shadow-light: #dfdfdf;
            --title-blue-dark: #000080;
            --title-blue-light: #1084d0;
            --terminal-bg: #0a0a0a;
            --terminal-bg-gradient: #1a1a1a;
            --terminal-text: #00ff88;
            --terminal-warn: #ff2222;
            --terminal-success: #44ff44;
            --terminal-cmd: #ffff44;
            --terminal-progress: #44aaff;
            --access-denied-red: #9d3434;
            --access-granted-green: #3d8f3d;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Courier Prime', monospace;
            font-size: 12px;
            background: #000;
            overflow: hidden;
            color: #ff6600;
            user-select: none;
        }
        
        .monitor {
            width: 100vw;
            height: 100vh;
            background: #1a1a1a;
            position: relative;
            border: 12px solid #2a2a2a;
            border-radius: 8px;
            box-shadow: 0 0 40px rgba(0,0,0,0.8) inset, 0 0 20px #000;
        }
        
        .desktop {
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, #3a3232 0%, #292222 40%, #110909 100%);
            position: relative;
            overflow: hidden;
        }
        
        .desktop::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: repeating-linear-gradient(0deg, rgba(255,255,255,0.02), rgba(255,255,255,0.02) 1px, transparent 1px, transparent 2px);
            pointer-events: none;
            animation: scanlines 0.2s linear infinite;
        }

        .desktop::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(18, 16, 16, 0.1);
            opacity: 0;
            pointer-events: none;
            animation: flicker 0.15s infinite;
        }
        
        @keyframes scanlines { from { transform: translateY(0); } to { transform: translateY(2px); } }
        @keyframes flicker { 0% { opacity: 0.1; } 20% { opacity: 1; } 80% { opacity: 0.3; } 100% { opacity: 1; } }
        
        .pi-symbol {
            position: absolute;
            bottom: 30px; right: 20px;
            font-size: 38px; color: #ff3333; font-weight: bold;
            text-shadow: 0 0 15px #ff3333, 0 0 25px #ff3333;
            animation: pulse-pi 3s infinite;
            cursor: pointer; transition: all 0.4s ease; z-index: 10;
            filter: drop-shadow(0 0 8px #ff3333);
        }
        
        .pi-symbol:hover {
            transform: scale(1.3) rotate(5deg);
            text-shadow: 0 0 25px #ff3333, 0 0 40px #ff3333;
            filter: drop-shadow(0 0 15px #ff3333);
        }
        
        @keyframes pulse-pi { 0%, 100% { opacity: 0.7; } 50% { opacity: 1; } }
        
        .main-menu-window { position: absolute; top: 60px; left: 120px; width: 650px; height: 420px; z-index: 100; }
        .terminal-window { position: absolute; top: 50px; right: 80px; width: 520px; height: 420px; z-index: 90; }
        .alert-window { position: absolute; bottom: 10px; right: 10px; width: 320px; height: 180px; z-index: 110; }
        
        .window {
            background: var(--base-grey);
            border: 2px outset var(--shadow-light);
            box-shadow: 8px 8px 16px rgba(0,0,0,0.6);
            border-radius: 2px;
            display: flex;
            flex-direction: column;
        }
        
        .title-bar {
            height: 26px;
            background: linear-gradient(to right, var(--title-blue-dark), var(--title-blue-light));
            color: white; font-weight: bold; font-size: 12px;
            display: flex; align-items: center; padding: 0 8px;
            justify-content: space-between; cursor: grab;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            transition: filter 0.2s;
        }
        
        .title-bar.dragging { filter: brightness(1.2); }
        .title-bar:active { cursor: grabbing; }
        .window-controls { display: flex; gap: 3px; }
        
        .control-btn {
            width: 18px; height: 16px; border: 2px outset var(--base-grey);
            background: var(--base-grey); font-size: 10px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; color: black; transition: all 0.1s; font-weight: bold;
        }
        
        .control-btn:hover { background: #d0d0d0; }
        .control-btn:active { border: 2px inset var(--base-grey); }
        
        .menu-area { flex-grow: 1; background: #5588CC; position: relative; overflow: hidden; border-top: 1px solid #fff; display: flex; }
        .sidebar { width: 130px; height: 100%; background: var(--base-grey); border-right: 2px solid var(--shadow-dark); padding: 8px 4px; }
        
        .menu-button {
            width: 100%; height: 38px; margin: 4px 0; background: var(--base-grey);
            border: 2px outset var(--base-grey); color: black; font-size: 10px; font-weight: bold;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: all 0.2s; text-shadow: 1px 1px 0px rgba(255,255,255,0.7);
        }
        
        .menu-button:hover { background: #d0d0d0; }
        .menu-button:active, .menu-button.selected { background: #a0a0a0; border: 2px inset var(--base-grey); }
        
        .main-content { flex-grow: 1; background: #008080; padding: 18px; }
        
        .content-header {
            color: white; font-size: 15px; font-weight: bold; margin-bottom: 18px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7); text-align: center; background: rgba(0,0,0,0.2);
            padding: 8px; border-radius: 3px; border: 1px solid rgba(255,255,255,0.3);
        }
        
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 18px; height: calc(100% - 60px); }
        
        .menu-item {
            background: var(--base-grey); border: 4px double var(--base-grey); padding: 12px;
            transition: all 0.3s; display: flex; flex-direction: column; align-items: center;
            justify-content: center; text-align: center; color: black; font-weight: bold;
            text-shadow: 1px 1px 0px rgba(255,255,255,0.7); border-radius: 4px; position: relative; overflow: hidden;
        }
        
        .menu-item.accessible {
            cursor: pointer;
            border-color: var(--access-granted-green);
        }
        .menu-item.accessible:hover { background: #d0d0d0; transform: scale(1.03); }
        .menu-item.accessible:active { border-style: inset; transform: scale(0.98); }

        .menu-item.denied {
            cursor: not-allowed;
            border-color: var(--access-denied-red);
            color: #555;
            background: #a0a0a0;
        }
        .menu-item.denied .lips-logo { filter: grayscale(100%) brightness(0.7); animation: none; }
        
        .menu-item.fully-accessible {
            border-color: var(--terminal-success);
            box-shadow: 0 0 15px rgba(0,255,0,0.4) inset, 0 0 15px rgba(0,255,0,0.4);
            animation: glow-green 2s infinite;
        }
        
        @keyframes glow-green {
            0%, 100% { box-shadow: 0 0 15px rgba(0,255,0,0.4) inset, 0 0 15px rgba(0,255,0,0.4); }
            50% { box-shadow: 0 0 25px rgba(0,255,0,0.7) inset, 0 0 25px rgba(0,255,0,0.7); }
        }
        
        .lips-logo {
            width: 45px; height: 28px; background: radial-gradient(ellipse, #FF4444 20%, #DD2222 60%, #BB0000 90%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%; margin-bottom: 10px; position: relative;
            animation: lips-glow 4s infinite; filter: drop-shadow(0 0 8px #FF4444);
        }
        
        .lips-logo::after {
            content: ''; position: absolute; top: 50%; left: 50%; width: 32px; height: 2px;
            background: #880000; transform: translate(-50%, -50%); border-radius: 1px;
            box-shadow: inset 0 1px 1px rgba(0,0,0,0.3);
        }
        
        @keyframes lips-glow {
            0%, 100% { filter: drop-shadow(0 0 8px #FF4444); transform: scale(1); }
            50% { filter: drop-shadow(0 0 18px #FF4444) drop-shadow(0 0 25px #FF4444); transform: scale(1.05); }
        }
        
        .terminal-area {
            flex-grow: 1; background: linear-gradient(135deg, var(--terminal-bg), var(--terminal-bg-gradient));
            color: var(--terminal-text); font-family: 'Courier Prime', monospace; font-size: 11px;
            padding: 10px; overflow-y: auto; position: relative; border: 2px inset #000;
        }

        .terminal-output .trace-line > span {
            text-shadow: 0 0 8px, 0 0 5px rgba(180, 255, 220, 0.5);
            animation: text-ghost 2s infinite alternate;
        }
        @keyframes text-ghost { from { text-shadow: 0 0 8px, 0 0 5px rgba(180, 255, 220, 0.5); } to { text-shadow: 0 0 2px, 0 0 2px rgba(180, 255, 220, 0.2); } }
        
        .trace-line { margin: 1px 0; min-height: 14px; font-size: 11px; line-height: 1.4; white-space: pre-wrap;}
        .timestamp { color: #888; margin-right: 10px; font-weight: bold; }
        .command { color: var(--terminal-cmd); }
        .response { color: var(--terminal-text); }
        .error { color: var(--terminal-warn); }
        .success { color: var(--terminal-success); }
        .header-info { color: #ff8844; }
        .trace-progress { color: var(--terminal-progress); animation: glow-blue 2s infinite; }
        .cathedral-warning { color: var(--terminal-warn); font-weight: bold; animation: urgent-flash 1.2s infinite; }
        
        @keyframes glow-blue { 0%, 100% { text-shadow: 0 0 3px var(--terminal-progress); } 50% { text-shadow: 0 0 8px var(--terminal-progress); } }
        @keyframes urgent-flash { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
        
        .cursor { background: var(--terminal-text); color: #000; animation: blink 1s infinite; padding: 0 1px;}
        @keyframes blink { 0%, 50% { opacity: 1; } 51%, 100% { opacity: 0; } }

        .terminal-input-line { display: flex; }
        .terminal-prompt { color: var(--terminal-cmd); }
        #commandInput {
            flex-grow: 1; background: transparent; border: none; color: var(--terminal-cmd);
            font-family: 'Courier Prime', monospace; font-size: 11px; outline: none;
        }
        
        .hidden { display: none !important; }
        
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: flex; align-items: center;
            justify-content: center; z-index: 2000; backdrop-filter: blur(2px);
        }
        
        .modal {
            background: var(--base-grey); border: 2px outset var(--shadow-light); padding: 2px;
            width: 450px; color: black; border-radius: 4px;
            box-shadow: 0 0 30px rgba(0,0,0,0.8); animation: modal-appear 0.3s ease-out;
        }

        .modal-title-bar {
            height: 26px; background: linear-gradient(to right, #800000, #d01010);
            color: white; font-weight: bold; font-size: 12px; display: flex;
            align-items: center; padding: 0 8px; justify-content: space-between;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }
        
        @keyframes modal-appear { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .modal-body { padding: 20px; text-align: center; }
        .modal-content { margin-bottom: 20px; font-size: 12px; line-height: 1.4; }
        .modal-input {
            background: #fff; border: 2px inset var(--shadow-dark); padding: 5px;
            font-family: 'Courier Prime', monospace; width: 80%; margin-bottom: 10px;
        }

        .modal-btn {
            margin: 6px 4px; padding: 8px 12px; background: var(--base-grey);
            border: 2px outset var(--base-grey); color: black; cursor: pointer;
            font-weight: bold; font-size: 11px; transition: all 0.2s;
        }
        
        .modal-btn:hover { background: #d0d0d0; }
        .modal-btn:active { border: 2px inset var(--base-grey); }
        
        .modal-btn.override, .modal-btn.danger { background: #d9534f; border-color: #d43f3a; color: white; }
        .modal-btn.override:hover, .modal-btn.danger:hover { background: #c9302c; }

        .data-list { list-style: none; text-align: left; margin: 15px auto; width: 90%; border: 1px inset var(--shadow-dark); background: #fff; padding: 5px; height: 150px; overflow-y: auto;}
        .data-list li { padding: 4px 8px; cursor: pointer; font-size: 10px; }
        .data-list li:hover { background: #000080; color: white; }
        .data-list li.selected { background: #333; color: white; }
        .data-list li.protected { color: #a00; font-weight: bold; }
        .data-list li.locked { color: #777; cursor: not-allowed; }


        .status-bar {
            position: absolute; bottom: 0; left: 0; right: 0; height: 24px;
            background: var(--base-grey); border-top: 2px solid var(--shadow-dark); display: flex;
            align-items: center; padding: 0 10px; font-size: 10px; color: #000;
        }
        
        .status-item {
            margin-right: 15px; display: flex; align-items: center;
            gap: 5px; border: 1px inset var(--shadow-dark); padding: 1px 5px;
        }
        
        .status-led {
            width: 8px; height: 8px; border-radius: 50%; background: var(--terminal-success);
            animation: pulse-led 2s infinite; box-shadow: 0 0 5px var(--terminal-success);
        }
        
        @keyframes pulse-led { 0%, 100% { opacity: 0.7; } 50% { opacity: 1; } }
        .status-led.warning { background: #ffaa00; box-shadow: 0 0 5px #ffaa00; }
        .status-led.error { background: var(--terminal-warn); box-shadow: 0 0 5px var(--terminal-warn); }
    </style>
</head>
<body>
    <div class="monitor">
        <div class="desktop">
            <div class="pi-symbol" onclick="triggerPiSequence()" title="Activate 'Mozart's Ghost' Backdoor">π</div>
            
            <div class="window main-menu-window" id="mainMenu">
                <div class="title-bar"><span>Cathedral Systems Menu v3.2</span></div>
                <div class="menu-area">
                    <div class="sidebar">
                        <div class="menu-button selected" onclick="selectMenu(event, 'programs')">PROGRAMS</div>
                        <div class="menu-button" onclick="selectMenu(event, 'systems')">SYSTEMS</div>
                        <div class="menu-button" onclick="selectMenu(event, 'commands')">COMMANDS</div>
                    </div>
                    <div class="main-content">
                        <div class="content-header" id="contentHeader">Cathedral Software Internal Systems Menu</div>
                        <div class="menu-grid" id="menuGrid"></div>
                    </div>
                </div>
            </div>
            
            <div class="window terminal-window" id="terminalWindow">
                <div class="title-bar"><span>Terminal Echo v2.1 - Secure Communications</span></div>
                <div class="terminal-area" id="terminal">
                    <div class="terminal-header">
                        CATHEDRAL SECURE TERMINAL v3.2 - ACTIVE SESSION
                        <br><span id="userStatus">USER: A.BENNETT@CATHEDRAL.COM - ACCESS LEVEL: 3 (GUEST)</span>
                    </div>
                    <div id="terminalOutput"></div>
                    <div class="trace-line terminal-input-line">
                        <span class="terminal-prompt">$ </span>
                        <span id="commandInput" contenteditable="false"></span>
                        <span class="cursor">█</span>
                    </div>
                </div>
            </div>

             <div class="window alert-window" id="alertWindow">
                <div class="title-bar"><span>System Alert</span></div>
                <div class="modal-body" style="background: var(--base-grey);">
                    <p style="font-weight:bold; color:#cc2222;">UNAUTHORIZED PORT SCAN DETECTED</p>
                    <p style="margin-top: 15px;">Source IP has been logged.<br>Please report any unusual activity to your system administrator.</p>
                </div>
            </div>
            
            <div id="systemModal" class="modal-overlay hidden">
                <div class="modal">
                    <div class="modal-title-bar">
                        <span id="modalTitle">GATEKEEPER SECURITY SYSTEM</span>
                        <div class="control-btn" id="modalCloseBtn">×</div>
                    </div>
                    <div class="modal-body" id="modalBody">
                        </div>
                </div>
            </div>
            
            <div class="status-bar">
                <div class="status-item"><div class="status-led" id="systemLed"></div><span>System: Online</span></div>
                <div class="status-item"><div class="status-led" id="networkLed"></div><span>Network: Connected</span></div>
                <div class="status-item"><div class="status-led warning" id="securityLed"></div><span id="securityStatus">Security: Active</span></div>
                <div class="status-item" style="margin-left: auto;"><span id="currentTime"></span></div>
            </div>
        </div>
    </div>

    <script>
        // --- GLOBAL STATE ---
        let clearanceLevel = 3;
        let commandHistory = [];
        let historyIndex = -1;
        let networkMonitorInterval = null;
        const terminalInput = document.getElementById('commandInput');
        const terminalOutput = document.getElementById('terminalOutput');
        const terminal = document.getElementById('terminal');

        // --- DATA ---
        const menuConfigs = {
            programs: { header: "Internal Systems Menu", items: [ {id: 'network-routing', name: 'Internetwork Routing Protocol', requiredLevel: 6}, {id: 'hr-storage', name: 'H.R. Storage', requiredLevel: 3}, {id: 'optical-archive', name: 'Optical Archive', requiredLevel: 6}, {id: 'email', name: 'Mail Server', requiredLevel: 3}, {id: 'file-server', name: 'File Server', requiredLevel: 3}, {id: 'facilities-mgmt', name: 'Facilities Mgmt', requiredLevel: 3}]},
            systems: { header: "System & Monitoring Tools", items: [ {id: 'user-mgmt', name: 'User Management', requiredLevel: 9}, {id: 'security-audit', name: 'Security Audit', requiredLevel: 3}, {id: 'backup-sys', name: 'Backup System', requiredLevel: 6}, {id: 'network-monitor', name: 'Network Monitor', requiredLevel: 9}, {id: 'firewall', name: 'Firewall Control', requiredLevel: 9}, {id: 'database', name: 'DB Admin', requiredLevel: 6}]},
            commands: { header: "System Commands", items: [ {id: 'diagnostics', name: 'System Diagnostics', requiredLevel: 3}, {id: 'task-manager', name: 'Process Task Manager', requiredLevel: 6}, {id: 'file-explorer', name: 'File System Explorer', requiredLevel: 3}]}
        };
        
        const fileSystem = {
            'DELETIONS.LOG': { content: `[21:03:14] User 'A.BENNETT' flagged for deletion by 'PRAETORIAN_GUARD'.\n[21:03:15] DELETING SSN...\n[21:03:15] DELETING CRIMINAL RECORD...\n[21:03:16] DELETING FINANCIAL HISTORY...\n[21:03:18] DELETING DRIVER'S LICENSE...\n[21:03:20] ASSIGNING NEW IDENTITY: RUTH MARX, ID: 458-00-3265`, requiredLevel: 3 },
            'PRAETORIANS.TXT': { content: `MEMO\nTO: J.DEVLIN\nFROM: <REDACTED>\nRE: The Praetorians\nOur group remains anonymous. Our influence grows through the Gatekeeper software. Any analyst, like Bennett, who gets too close must be ghosted.`, requiredLevel: 3 },
            'MOZART.MSG': { content: `--- MESSAGE FRAGMENT ---\n...found a backdoor. It's beautiful, like a Mozart's Ghost in the machine. There's a symbol, a simple π in the corner of the GUI. If you can get to it, you can bypass Gatekeeper entirely.`, requiredLevel: 6 },
            'GATEKEEPER.SYS': { content: `// GATEKEEPER v2.1 SYSTEM CONFIG\n[BACKDOOR]\nACTIVATION_KEY=PI_SYMBOL_CLICK\nACCESS_LEVEL=ROOT`, requiredLevel: 9 }
        };

        const processList = [
            {pid: 101, name: 'system.exe', user: 'SYSTEM'}, {pid: 230, name: 'svchost.exe', user: 'SYSTEM'},
            {pid: 455, name: 'explorer.exe', user: 'a.bennett'}, {pid: 489, name: 'gatekeeper.exe', user: 'SYSTEM', protected: true},
            {pid: 512, name: 'terminal.exe', user: 'a.bennett'},
        ];

        const commandList = { 'help': 'Lists all available commands.', 'cat [filename]': 'Displays the content of a file.', 'trace [host]': 'Traces the network route to a host.', 'whois [domain]': 'Looks up information about a domain.', 'ping [host]': 'Checks connectivity to a host.', 'clear': 'Clears the terminal screen.' };
        
        // --- AUDIO ---
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        function playBeep(frequency = 800, duration = 0.05, volume = 0.03, type = 'sine') { try { const o=audioContext.createOscillator(),g=audioContext.createGain();o.connect(g),g.connect(audioContext.destination),o.frequency.value=frequency,o.type=type,g.gain.setValueAtTime(volume,audioContext.currentTime),g.gain.exponentialRampToValueAtTime(1e-4,audioContext.currentTime+duration),o.start(audioContext.currentTime),o.stop(audioContext.currentTime+duration)}catch(e){}}

        // --- TERMINAL & COMMANDS ---
        function addTerminalLine(content, className = 'response') { const line=document.createElement('div');line.className='trace-line',line.classList.add(className),line.innerHTML=content,terminalOutput.appendChild(line),scrollTerminal(); return Promise.resolve()}
        async function typeTerminalText(text, speed = 15) { const line=document.createElement('div');line.className='trace-line response',terminalOutput.appendChild(line);for(let i=0;i<text.length;i++)await new Promise(r=>setTimeout(r,speed)),line.textContent+=text[i],"\n"===text[i]&&scrollTerminal();scrollTerminal()}
        async function processCommand(fullCommand) {
            if (!fullCommand) return;
            await addTerminalLine(`$ ${fullCommand}`, 'command');
            commandHistory.unshift(fullCommand);
            historyIndex = -1;
            const [command, ...args] = fullCommand.split(' ');
            const arg = args.join(' ');

            switch(command.toLowerCase()) {
                case "help":
                    addTerminalLine("Available commands:","header-info");
                    for(const cmd in commandList) addTerminalLine(`<span class="command">${cmd.padEnd(18," ")}</span> <span class="response">${commandList[cmd]}</span>`);
                    break;
                case "cat":
                    const fileName = arg.toUpperCase();
                    if (fileSystem[fileName]) {
                        if (clearanceLevel >= fileSystem[fileName].requiredLevel) await typeTerminalText(fileSystem[fileName].content);
                        else await addTerminalLine("Error: Access denied. Insufficient clearance.", "error");
                    } else await addTerminalLine(`Error: File not found: ${arg}`, "error");
                    break;
                case "clear":
                    terminalOutput.innerHTML = "";
                    if (networkMonitorInterval) { clearInterval(networkMonitorInterval); networkMonitorInterval = null; }
                    break;
                case "trace": await executeTrace(arg || "greg.com"); break;
                case "whois": await executeWhois(arg || "cathedral.com"); break;
                case "ping": await executePing(arg || "cathedral.com"); break;
                default:
                    await addTerminalLine(`Command not found: ${command}. Type 'help' for commands.`, 'error');
            }
        }
        async function executeTrace(host){await addTerminalLine(`Tracing route to ${host}...`,"trace-progress"),await new Promise(r=>setTimeout(r,500)),await addTerminalLine("1  gateway.home (192.168.1.1)  1.231 ms"),await new Promise(r=>setTimeout(r,500)),await addTerminalLine("2  c-24-130-150-1.ca.us.corp.net (24.130.150.1)  10.482 ms"),await new Promise(r=>setTimeout(r,500)),await addTerminalLine("3  praetorian-inbound.net (75.75.28.142)  21.904 ms"),await new Promise(r=>setTimeout(r,500)),await addTerminalLine("4  GATEKEEPER.CATHEDRAL.COM (204.77.88.15)  25.331 ms","header-info"),await addTerminalLine("Trace complete.","success")}
        async function executeWhois(domain){await addTerminalLine(`Querying WHOIS for ${domain}...`,"trace-progress"),await new Promise(r=>setTimeout(r,800)),await addTerminalLine(`Domain: ${domain.toUpperCase()}`),await addTerminalLine("Registrant: PRAETORIAN GUARD LLC","header-info"),await addTerminalLine("Admin Contact: <DATA EXPUNGED BY GATEKEEPER>","error"),await addTerminalLine("Status: ACTIVE - PROTECTED","success")}
        async function executePing(host){await addTerminalLine(`PING ${host} (204.77.88.15): 56 data bytes`,"response");for(let i=1;4>=i;i++)await new Promise(r=>setTimeout(r,600)),await addTerminalLine(`64 bytes from 204.77.88.15: icmp_seq=${i} ttl=64 time=${(15*Math.random()+10).toFixed(3)} ms`);await addTerminalLine("--- 4 packets transmitted, 4 received, 0% loss ---","success")}
        
        // --- MAIN UI & MODAL ---
        function refreshMenuBar(){const currentMenuButton=document.querySelector(".menu-button.selected");if(currentMenuButton)selectMenu({currentTarget:currentMenuButton},currentMenuButton.dataset.menu)}
        function selectMenu(event, menuType) {
            playBeep(1200, 0.05, 0.04);
            document.querySelectorAll('.menu-button').forEach(btn => btn.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            event.currentTarget.dataset.menu = menuType;
            
            const config = menuConfigs[menuType];
            document.getElementById('contentHeader').textContent = config.header;
            
            const grid = document.getElementById('menuGrid');
            grid.innerHTML = '';
            
            config.items.forEach(item => {
                const menuItem = document.createElement('div');
                menuItem.className = 'menu-item';

                menuItem.classList.remove('accessible', 'denied', 'fully-accessible');
                if (clearanceLevel >= item.requiredLevel) {
                    menuItem.classList.add('accessible');
                    if (clearanceLevel === 9) menuItem.classList.add('fully-accessible');
                } else {
                    menuItem.classList.add('denied');
                }
                
                menuItem.onclick = async () => {
                    if (clearanceLevel >= item.requiredLevel) {
                        if (networkMonitorInterval) { clearInterval(networkMonitorInterval); networkMonitorInterval = null; addTerminalLine('Network monitor stopped.', 'header-info'); }
                        launchSystem(item.id);
                    } else {
                        playBeep(300, 0.1, 0.04, 'sawtooth');
                        showModal('generic-denial');
                    }
                };
                menuItem.innerHTML = `<div class="lips-logo"></div><div style="white-space: pre-wrap;">${item.name}</div>`;
                grid.appendChild(menuItem);
            });
        }
        
        function launchSystem(systemId) { showModal(systemId); }
        
        function showModal(type) {
            const modal = document.getElementById('systemModal'), modalBody = document.getElementById('modalBody'), modalTitle = document.getElementById('modalTitle');
            playBeep(400, .1, .05, "square");
            let content = '';
            modalTitle.textContent = "System Interface";

            switch(type) {
                case 'user-mgmt':
                    modalTitle.textContent = "User Account Management";
                    content = `<div class="modal-content">Select a user to manage:</div><ul class="data-list" id="userList"><li>a.bennett</li> <li class="protected">j.devlin</li> <li>d.richards</li> <li>s.winn</li> <li>r.marx</li></ul><div class="modal-btn danger" id="deleteUserBtn">Delete User</div>`;
                    break;
                case 'firewall':
                    modalTitle.textContent = "Firewall Control";
                    content = `<div class="modal-content">GATEKEEPER Firewall Rules:</div><ul class="data-list" id="firewallRules"><li>ALLOW ALL ON PORT 80, 443</li><li class="protected">DENY ALL FROM PRAETORIAN_NET</li><li>ALLOW SSH FROM ADMIN_IP</li><li>ALLOW ICMP</li></ul><div class="modal-btn">Add Rule</div><div class="modal-btn danger" id="deleteRuleBtn">Delete Rule</div>`;
                    break;
                case 'network-routing':
                    if (clearanceLevel >= 6) {
                        closeModal();
                        addTerminalLine("Routing protocol already exploited.", "header-info");
                        return;
                    }
                    modalTitle.textContent = "Privilege Escalation Exploit";
                    content = `<div class="modal-content">This terminal requires a password to override routing tables and elevate privileges.</div><input type="password" id="routeOverrideInput" class="modal-input" /><div class="modal-btn" id="executeRouteBtn">Execute</div>`;
                    break;
                case 'task-manager':
                    modalTitle.textContent = "Process Task Manager";
                    let processesHTML = processList.map(p => `<li class="${p.protected ? 'protected' : ''}" data-pid="${p.pid}">${p.pid.toString().padEnd(6)}${p.name.padEnd(18)}${p.user}</li>`).join('');
                    content = `<div class="modal-content">Running Processes:</div><ul class="data-list" id="processList">${processesHTML}</ul><div class="modal-btn danger" id="killProcBtn">Terminate Process</div>`;
                    break;
                case 'file-explorer':
                    modalTitle.textContent = "File System Explorer";
                    let filesHTML = Object.keys(fileSystem).map(f => `<li class="${clearanceLevel >= fileSystem[f].requiredLevel ? '' : 'locked'}" data-filename="${f}">${f}</li>`).join('');
                    content = `<div class="modal-content">System Files:</div><ul class="data-list" id="fileList">${filesHTML}</ul><div class="modal-btn" id="viewFileBtn">View Selected File</div>`;
                    break;
                case 'diagnostics': closeModal(); runDiagnostics(); return;
                case 'security-audit': closeModal(); runSecurityAudit(); return;
                case 'backup-sys': closeModal(); runBackup(); return;
                case 'database': closeModal(); runDBCheck(); return;
                case 'optical-archive': closeModal(); runDataRetrieval(); return;
                case 'hr-storage':
                case 'email':
                case 'file-server':
                case 'facilities-mgmt':
                    closeModal();
                    addTerminalLine(`Accessing ${type.replace('-', ' ')}... Connection successful.`, 'success');
                    return;
                default:
                    modalTitle.textContent = "GATEKEEPER SECURITY SYSTEM";
                    content = `<div class="modal-header">🔒 ACCESS DENIED</div><div class="modal-content">System requires a higher clearance level.</div><div class="modal-btn" id="modalAckBtn">ACKNOWLEDGE</div>`;
            }
            
            modalBody.innerHTML = content;

            const btnHandlers = {
                'user-mgmt': () => { document.getElementById('deleteUserBtn').onclick = deleteSelectedUser; setupListSelection('userList'); },
                'firewall': () => { document.getElementById('deleteRuleBtn').onclick = deleteFirewallRule; setupListSelection('firewallRules'); },
                'network-routing': () => { 
                    document.getElementById('executeRouteBtn').onclick = executeRouteOverride;
                    document.getElementById('routeOverrideInput').focus();
                },
                'task-manager': () => { document.getElementById('killProcBtn').onclick = killSelectedProcess; setupListSelection('processList'); },
                'file-explorer': () => { document.getElementById('viewFileBtn').onclick = viewSelectedFile; setupListSelection('fileList'); },
                'generic-denial': () => { document.getElementById('modalAckBtn').addEventListener('click', closeModal); }
            };
            (btnHandlers[type] || btnHandlers['generic-denial'])();
            
            modal.classList.remove('hidden');
        }

        function setupListSelection(listId) {
            document.querySelectorAll(`#${listId} li`).forEach(li => li.onclick = (e) => {
                if (e.target.classList.contains('locked')) return;
                document.querySelectorAll(`#${listId} li`).forEach(i => i.classList.remove('selected'));
                e.target.classList.add('selected');
            });
        }
        
        // --- Fleshed out Feature Functions ---
        function deleteSelectedUser(){const selected=document.querySelector("#userList li.selected");if(!selected)return;const username=selected.textContent.trim();closeModal();addTerminalLine(`$ userdel ${username}`,'command');setTimeout(async()=>{await("j.devlin"===username?(addTerminalLine("ERROR: User 'j.devlin' is protected by GATEKEEPER.","error"),addTerminalLine("*** Security alert triggered! Action logged. ***","cathedral-warning")):addTerminalLine(`User '${username}' deleted successfully.`,"success"))},500)}
        function deleteFirewallRule(){const selected=document.querySelector("#firewallRules li.selected");if(!selected)return;const ruleText=selected.textContent.trim();closeModal();addTerminalLine(`$ firewall -d "${ruleText}"`,'command');setTimeout(async()=>{await(selected.classList.contains("protected")?(addTerminalLine("ERROR: Rule is protected by GATEKEEPER.","error"),addTerminalLine("*** Critical system rule. Deletion denied. ***","cathedral-warning")):addTerminalLine("Rule deleted successfully.","success"))},500)}
        async function runSecurityAudit(){await addTerminalLine("$ run security.audit",'command'),await addTerminalLine("Scanning system logs for anomalies...","trace-progress"),await new Promise(r=>setTimeout(r,1e3)),await(clearanceLevel>=6? (addTerminalLine("LEVEL 6+ SCAN COMPLETE. DISPLAYING FULL LOG:","success"),typeTerminalText("[10:25] ALERT: Failed login for 'root' from 13.107.21.200\n[10:26] PACKET_CAPTURE: Plaintext password 'natoar23ae' detected in transit.\n[10:28] AUTH: Login success for 'j.devlin' from 13.107.21.200",25)):(addTerminalLine("LEVEL 3 SCAN COMPLETE. DISPLAYING REDACTED LOG:","header-info"),typeTerminalText("[10:22] ALERT: Port scan detected from [REDACTED]\n[10:25] ALERT: Failed login for 'root' from [REDACTED]",25)))}
        function executeRouteOverride() {
            const input = document.getElementById('routeOverrideInput').value;
            closeModal();
            if (input === 'natoar23ae') {
                runPrivilegeEscalation();
            } else {
                addTerminalLine(`$ route_override ********`,'command');
                setTimeout(()=>addTerminalLine('Error: Invalid password.', 'error'), 500);
            }
        }
        async function runPrivilegeEscalation() {
            await addTerminalLine('$ ./exploit/route_poison.sh','command');
            await addTerminalLine('Initializing memory heap spray...', 'trace-progress');
            await new Promise(r => setTimeout(r, 1500));
            await addTerminalLine('SUCCESS: Return pointer overwritten.', 'success');
            await new Promise(r => setTimeout(r, 500));
            await addTerminalLine('Spawning new shell with elevated privileges...', 'trace-progress');
            await new Promise(r => setTimeout(r, 1000));
            clearanceLevel = 6;
            document.getElementById('userStatus').innerHTML = `USER: A.BENNETT@CATHEDRAL.COM - ACCESS LEVEL: ${clearanceLevel} (ELEVATED)`;
            await addTerminalLine(`Clearance Level upgraded: 3 -> 6`, 'success');
            refreshMenuBar();
        }
        async function runDiagnostics() {await addTerminalLine('$ ./diag --all','command');await new Promise(r=>setTimeout(r,500));await addTerminalLine('Checking CPU... <span class="success">OK</span>');await new Promise(r=>setTimeout(r,500));await addTerminalLine('Checking Memory... <span class="success">OK</span>');await new Promise(r=>setTimeout(r,500));await addTerminalLine('Checking Network Controller... <span class="success">OK</span>');await new Promise(r=>setTimeout(r,500));await addTerminalLine('All systems nominal.', 'success');}
        function killSelectedProcess() {const selected=document.querySelector('#processList li.selected');if(!selected)return;const pid=selected.dataset.pid,isProtected=processList.find(p=>p.pid==pid).protected;closeModal(),addTerminalLine(`$ kill -9 ${pid}`,'command'),setTimeout(async()=>{isProtected?await addTerminalLine(`ERROR: Access denied. Process ${pid} is protected by GATEKEEPER.`,"error"):await addTerminalLine(`Process ${pid} terminated.`,"success")},500)}
        function viewSelectedFile() {const selected=document.querySelector('#fileList li.selected');if(!selected)return;const filename=selected.dataset.filename;closeModal(),processCommand(`cat ${filename}`)}
        async function runBackup() {await addTerminalLine('$ ./backup --full','command');await addTerminalLine('Starting full system backup...','trace-progress'); for(let i=0;100>=i;i+=10)await new Promise(r=>setTimeout(r,250)),await addTerminalLine(`Progress: ${i}%`);await addTerminalLine('Backup complete.','success');}
        async function runDBCheck() {await addTerminalLine('$ ./db_check --verify','command');await addTerminalLine('Verifying database integrity...','trace-progress');await new Promise(r=>setTimeout(r,1500));await addTerminalLine('No errors found.','success');}
        async function runDataRetrieval() {await addTerminalLine('$ ./tape_archive -r latest','command');await addTerminalLine('Accessing optical archive...','trace-progress');await new Promise(r=>setTimeout(r,1500));await addTerminalLine('Data retrieval successful.','success');}

        function closeModal(){const modal=document.getElementById("systemModal");modal.classList.contains("hidden")||(playBeep(600,.05,.03),modal.classList.add("hidden"))}
        
        async function triggerPiSequence() {
            if (clearanceLevel === 9) return;
            clearanceLevel = 9;
            const pi=document.querySelector(".pi-symbol");pi.style.transform="scale(1.5) rotate(720deg)",pi.style.color="#00ff00",pi.style.textShadow="0 0 30px #00ff00, 0 0 50px #00ff00";for(let i=0;5>i;i++)playBeep(800+200*i,.1,.05),await new Promise(r=>setTimeout(r,150));await addTerminalLine('π SYMBOL ACTIVATED - "MOZART\'S GHOST" INITIATED',"cathedral-warning"),await addTerminalLine("Bypassing GATEKEEPER authentication matrix...","trace-progress"),await addTerminalLine("*** BACKDOOR ACTIVE. ALL PRIVILEGES GRANTED. ***","success"),await addTerminalLine("Welcome back, Angela.","success");
            const securityLed=document.getElementById("securityLed");securityLed.classList.remove("warning","error"),securityLed.style.background="var(--terminal-success)",securityLed.style.boxShadow="0 0 5px var(--terminal-success)",document.getElementById("securityStatus").textContent="Security: Bypassed",document.getElementById("userStatus").innerHTML=`USER: A.BENNETT@CATHEDRAL.COM - ACCESS LEVEL: ${clearanceLevel} (ADMINISTRATOR)`,refreshMenuBar()
        }

        // --- INITIALIZATION & EVENT LISTENERS ---
        function scrollTerminal() { terminal.scrollTop = terminal.scrollHeight; }
        function makeDraggable(win) { const title=win.querySelector(".title-bar");title.addEventListener("mousedown",e=>{let offsetX=e.clientX-win.offsetLeft,offsetY=e.clientY-win.offsetTop;title.classList.add("dragging"),document.querySelectorAll(".window").forEach(w=>w.style.zIndex=parseInt(getComputedStyle(w).zIndex)-10),win.style.zIndex=150;const mouseMove=e=>{win.style.left=`${e.clientX-offsetX}px`,win.style.top=`${e.clientY-offsetY}px`},mouseUp=()=>{document.removeEventListener("mousemove",mouseMove),document.removeEventListener("mouseup",mouseUp),title.classList.remove("dragging")};document.addEventListener("mousemove",mouseMove),document.addEventListener("mouseup",mouseUp)})}
        
        let isModalInputActive = false;
        function handleGlobalInput(e) {
            if (isModalInputActive) { return; }
            if("Enter"===e.key)e.preventDefault(),processCommand(terminalInput.textContent.trim()),terminalInput.textContent="";else if("Backspace"===e.key)terminalInput.textContent=terminalInput.textContent.slice(0,-1);else if(1===e.key.length&&!e.ctrlKey&&!e.metaKey)terminalInput.textContent+=e.key;else if("ArrowUp"===e.key){e.preventDefault();if(0<commandHistory.length){historyIndex=Math.min(historyIndex+1,commandHistory.length-1);const t=commandHistory[historyIndex];terminalInput.textContent=t}}else"ArrowDown"===e.key&&(e.preventDefault(),0<historyIndex?(historyIndex--,terminalInput.textContent=commandHistory[historyIndex]):(historyIndex=-1,terminalInput.textContent=""))
        }

        document.addEventListener("keydown",e=>{
            const modalIsVisible=!document.getElementById("systemModal").classList.contains("hidden");
            if(modalIsVisible) {
                const modalInput = document.getElementById('routeOverrideInput');
                if (modalInput && document.activeElement === modalInput) {
                    isModalInputActive = true;
                } else {
                    isModalInputActive = false;
                    closeModal();
                }
            } else {
                isModalInputActive = false;
                handleGlobalInput(e)
            }
        });
        
        document.addEventListener("DOMContentLoaded",()=>{makeDraggable(document.getElementById("mainMenu")),makeDraggable(document.getElementById("terminalWindow")),makeDraggable(document.getElementById("alertWindow")),document.getElementById("modalCloseBtn").addEventListener("click",closeModal),selectMenu({currentTarget:document.querySelector(".menu-button")},"programs"),setInterval(()=>document.getElementById("currentTime").textContent=(new Date).toLocaleTimeString(),1e3),addTerminalLine("Gatekeeper Systems Online. Type 'help' for available commands.","success")});

    </script>
</body>
</html>